{% extends 'base.html' %}
{% load bootstrap3 %}
{% load static %}

{% block bootstrap3_extra_script %}
  <script src={% static "js/navbar.js" %}></script>
  <script src={% static "js/content_filter.js" %}></script>
{% endblock %}

{% block title %}
  {% if webpage_title %}
    {{ webpage_title }}
  {% else %}
    {{ path_tail }}
  {% endif %}
{% endblock %}

{% block body%}
  <div class="container" style="margin-top:100px">

    <div class="panel panel-default">
      <div class="panel-body">
        Content of {% if last_path_element %}{{ last_path_element }}{% else %}root directory{% endif %}
      </div>
    </div>

    <div class="list-group">
        {% for directory in directories %}
          {% if path or not directory.is_parent %}
            {% if directory.relative_path %}
                <a href="{% if not path %}path/{% endif %}{{ directory }}/" class="list-group-item">
                  <img src="{% static "images/" %}{{ directory.media_type.image }}" height="33" width="33">{{ directory }}
                </a>
            {% else %}
                <a href="/"><img src="{% static "images/" %}{{ directory.media_type.image }}" height="33" width="33"  class="list-group-item">{{ directory }}</a>
            {% endif %}
          {% endif %}
        {% endfor %}

        {% for file in files %}
          {% if file.get_media_type %} {# it is some kind of media, so render peek window #}
              <a title="Click to show/hide content" type="button" onclick="if(document.getElementById('spoiler_{{ file }}') .style.display=='none') {document.getElementById('spoiler_{{ file }}') .style.display=''}else{document.getElementById('spoiler_%s') .style.display='none'}">
                <img src="{% static "images/play.png" %}" width="30">
              </a>
              {% if file.get_media_type == "Video" %}
                  <p id="spoiler_{{ file }}" style="display:none;clear:both">
                      <video height="480" width="640" preload="none" controls>
                          <source src="/file/{{ file.get_full_path }}/">
                          Your brower is piece of crap
                      </video>'demo/
                  </p>
              {% elif file.get_media_type == "Audio" %}
                  <p id="spoiler_{{ file }}" style="display:none;clear:both">
                      <audio preload="none" controls>
                          <source src="/file/{{ file.get_full_path }}/">
                          Your brower is piece of crap
                      </audio>
                  </p>
              {% elif file.get_media_type == "Picture" %}
                  <p id="spoiler_{{ file }}" style="display:none;clear:both">
                      <img src="/file/{{ file.get_full_path }}/">
                  </p>
              {% elif file.get_media_type == "Text" %}
                  <p id="spoiler_{{ file }}" style="display:none;clear:both">
                    <span style="white-space: pre-line">
                      <code>
                        {{ file.get_content }}
                      </code>
                    </span>
                  </p>
              {% endif %}

          {% else %}
            <img src="{% static "images/blank.png" %}" width="30">
          {% endif %}
            <a href="/file/{{ file.get_full_path }}/" class="list-group-item"><img src="{% static "images/" %}{{ file.media_type.image }}" height="33" width="33">{{ file }}
            </a>
          </li>
        {% endfor %}
    </div>

  {% if loadtime %}
    <div class="panel panel-default">
      <div class="panel-body">
        loaded in {{ loadtime }}ms
      </div>
    </div>
  {% endif %}

  </div>

{% endblock %}


{% block navbar_content %}
  <ul class="nav navbar-nav">
    {% for element in path_elements %}
      <li><a href="/path/{{ element.0 }}">{{ element.1 }}</a></li>
    {% endfor %}
  </ul>

  <ul class="nav navbar-nav navbar-right">
    {% if user.is_anonymous %}
      <li><a href="/login/{{ current_path }}"><span class="glyphicon glyphicon-log-in"></span>Login</a></li>
    {% else %}
      <li><a href="/logout"><span class="glyphicon glyphicon-log-in"></span>Login</a></li>
    {% endif %}
  </ul>

  <form class="navbar-form navbar-right">
    <div class="input-group">
      <input type="text" class="form-control" id="filterInput" placeholder="Filter..." name="search">
    </div>
  </form>
{% endblock %}
